# Catsonality é–‹ç™ºè¨ˆç”»

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

Catsonalityã¯çŒ«ã®æ€§æ ¼è¨ºæ–­ã‚µã‚¤ãƒˆã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ15ã®è³ªå•ã«ç­”ãˆã‚‹ã“ã¨ã§ã€8ç¨®é¡ã®çŒ«æ€§æ ¼ã‚¿ã‚¤ãƒ—ã®ã†ã¡1ã¤ã®è¨ºæ–­çµæœã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚

### å®Œæˆæ¸ˆã¿æ©Ÿèƒ½
- âœ… ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… 15å•ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ï¼ˆ5ãƒšãƒ¼ã‚¸ + ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ï¼‰
- âœ… çµæœãƒšãƒ¼ã‚¸ï¼ˆãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã€æ¬¡å…ƒåˆ†æã€è©³ç´°èª¬æ˜ï¼‰
- âœ… ã‚·ã‚§ã‚¢ç”»åƒç”Ÿæˆï¼ˆhtml2canvas + QRã‚³ãƒ¼ãƒ‰ï¼‰
- âœ… GitHub Pages ãƒ‡ãƒ—ãƒ­ã‚¤ï¼šhttps://mgalo1231.github.io/catsonality/

### é–‹ç™ºäºˆå®šæ©Ÿèƒ½
- ğŸ”² ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ï¼ˆç™»éŒ²/ãƒ­ã‚°ã‚¤ãƒ³ï¼‰
- ğŸ”² ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ©Ÿèƒ½ï¼ˆæŠ•ç¨¿/ã„ã„ã­/ã‚³ãƒ¡ãƒ³ãƒˆï¼‰
- ğŸ”² ãƒã‚¤ãƒšãƒ¼ã‚¸
- ğŸ”² åŒã‚¿ã‚¤ãƒ—ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤º

---

## æŠ€è¡“æ§‹æˆ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ï¼šSupabase
- **èªè¨¼**ï¼šEmail/Password ãƒ­ã‚°ã‚¤ãƒ³
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**ï¼šPostgreSQL
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒã‚¿ãƒ¼ã€ã‚·ã‚§ã‚¢ç”»åƒ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **ï¼šæ–°è¦æŠ•ç¨¿é€šçŸ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- é™çš„ HTML/CSS/JavaScript
- Supabase JS SDK
- GitHub Pages ã§ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 1. profilesï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼‰
| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ã‚¿ã‚¤ãƒ— | èª¬æ˜ |
|-----------|--------|------|
| id | UUID | ä¸»ã‚­ãƒ¼ã€auth.users ã¨é€£æº |
| username | TEXT | ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯çŒ«ã®åå‰ï¼‰ |
| avatar_url | TEXT | ã‚¢ãƒã‚¿ãƒ¼URL |
| primary_cat_type | TEXT | è¡¨ç¤ºã™ã‚‹çŒ«ã‚¿ã‚¤ãƒ—ãƒ©ãƒ™ãƒ« |
| created_at | TIMESTAMP | ç™»éŒ²æ—¥æ™‚ |
| updated_at | TIMESTAMP | æ›´æ–°æ—¥æ™‚ |

### 2. resultsï¼ˆè¨ºæ–­çµæœï¼‰
| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ã‚¿ã‚¤ãƒ— | èª¬æ˜ |
|-----------|--------|------|
| id | UUID | ä¸»ã‚­ãƒ¼ |
| user_id | UUID | å¤–éƒ¨ã‚­ãƒ¼ â†’ profiles.idï¼ˆåŒ¿åæ™‚ã¯nullï¼‰ |
| session_id | TEXT | åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³è­˜åˆ¥å­ |
| cat_type | TEXT | è¨ºæ–­çµæœã‚¿ã‚¤ãƒ— |
| cat_name | TEXT | çŒ«ã®åå‰ |
| cat_avatar | TEXT | çŒ«ã®ã‚¢ãƒã‚¿ãƒ¼ |
| scores | JSONB | 5æ¬¡å…ƒã‚¹ã‚³ã‚¢ |
| created_at | TIMESTAMP | è¨ºæ–­æ—¥æ™‚ |

### 3. postsï¼ˆæŠ•ç¨¿ï¼‰
| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ã‚¿ã‚¤ãƒ— | èª¬æ˜ |
|-----------|--------|------|
| id | UUID | ä¸»ã‚­ãƒ¼ |
| user_id | UUID | å¤–éƒ¨ã‚­ãƒ¼ â†’ profiles.id |
| result_id | UUID | å¤–éƒ¨ã‚­ãƒ¼ â†’ results.id |
| caption | TEXT | æŠ•ç¨¿å†…å®¹ï¼ˆç·¨é›†å¯èƒ½ï¼‰ |
| share_image_url | TEXT | ã‚·ã‚§ã‚¢ç”»åƒURL |
| likes_count | INTEGER | ã„ã„ã­æ•° |
| comments_count | INTEGER | ã‚³ãƒ¡ãƒ³ãƒˆæ•° |
| created_at | TIMESTAMP | æŠ•ç¨¿æ—¥æ™‚ |
| updated_at | TIMESTAMP | ç·¨é›†æ—¥æ™‚ |

### 4. likesï¼ˆã„ã„ã­ï¼‰
| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ã‚¿ã‚¤ãƒ— | èª¬æ˜ |
|-----------|--------|------|
| id | UUID | ä¸»ã‚­ãƒ¼ |
| post_id | UUID | å¤–éƒ¨ã‚­ãƒ¼ â†’ posts.id |
| user_id | UUID | å¤–éƒ¨ã‚­ãƒ¼ â†’ profiles.id |
| created_at | TIMESTAMP | ã„ã„ã­æ—¥æ™‚ |

### 5. commentsï¼ˆã‚³ãƒ¡ãƒ³ãƒˆï¼‰
| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ã‚¿ã‚¤ãƒ— | èª¬æ˜ |
|-----------|--------|------|
| id | UUID | ä¸»ã‚­ãƒ¼ |
| post_id | UUID | å¤–éƒ¨ã‚­ãƒ¼ â†’ posts.id |
| user_id | UUID | å¤–éƒ¨ã‚­ãƒ¼ â†’ profiles.id |
| parent_id | UUID | å¤–éƒ¨ã‚­ãƒ¼ â†’ comments.idï¼ˆè¿”ä¿¡ç”¨ï¼‰ |
| content | TEXT | ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹ |
| likes_count | INTEGER | ã‚³ãƒ¡ãƒ³ãƒˆã„ã„ã­æ•° |
| created_at | TIMESTAMP | ã‚³ãƒ¡ãƒ³ãƒˆæ—¥æ™‚ |

### 6. comment_likesï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã„ã„ã­ï¼‰
| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ã‚¿ã‚¤ãƒ— | èª¬æ˜ |
|-----------|--------|------|
| id | UUID | ä¸»ã‚­ãƒ¼ |
| comment_id | UUID | å¤–éƒ¨ã‚­ãƒ¼ â†’ comments.id |
| user_id | UUID | å¤–éƒ¨ã‚­ãƒ¼ â†’ profiles.id |
| created_at | TIMESTAMP | ã„ã„ã­æ—¥æ™‚ |

---

## ãƒšãƒ¼ã‚¸æ§‹æˆ

### æ–°è¦ä½œæˆãƒšãƒ¼ã‚¸
| ãƒ•ã‚¡ã‚¤ãƒ« | æ©Ÿèƒ½ |
|----------|------|
| community.html | ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ä¸€è¦§ï¼ˆã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«ï¼‰ |
| mypage.html | ãƒã‚¤ãƒšãƒ¼ã‚¸ |

### ä¿®æ­£ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸
| ãƒ•ã‚¡ã‚¤ãƒ« | ä¿®æ­£å†…å®¹ |
|----------|---------|
| index.html | ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¿½åŠ  |
| result.html | ã€Œã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«æŠ•ç¨¿ã€ãƒœã‚¿ãƒ³è¿½åŠ ã€åŒã‚¿ã‚¤ãƒ—ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤º |
| login.html | å®Ÿéš›ã®ãƒ­ã‚°ã‚¤ãƒ³/ç™»éŒ²æ©Ÿèƒ½ |
| å…¨ãƒšãƒ¼ã‚¸ | ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çµ±ä¸€ |

### JS ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
| ãƒ•ã‚¡ã‚¤ãƒ« | æ©Ÿèƒ½ |
|----------|------|
| js/supabase.js | Supabase åˆæœŸåŒ– |
| js/auth.js | èªè¨¼é–¢é€£ |
| js/community.js | ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ©Ÿèƒ½ |
| js/mypage.js | ãƒã‚¤ãƒšãƒ¼ã‚¸æ©Ÿèƒ½ |

### CSS ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ
| ãƒ•ã‚¡ã‚¤ãƒ« | æ©Ÿèƒ½ |
|----------|------|
| css/community.css | ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒšãƒ¼ã‚¸ã‚¹ã‚¿ã‚¤ãƒ« |
| css/mypage.css | ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚¹ã‚¿ã‚¤ãƒ« |

---

## æ¨©é™åˆ¶å¾¡

| æ©Ÿèƒ½ | æœªãƒ­ã‚°ã‚¤ãƒ³ | ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ |
|------|-----------|-------------|
| ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£é–²è¦§ | âœ… | âœ… |
| æŠ•ç¨¿è©³ç´°é–²è¦§ | âœ… | âœ… |
| ã‚³ãƒ¡ãƒ³ãƒˆé–²è¦§ | âœ… | âœ… |
| æŠ•ç¨¿ã«ã„ã„ã­ | âŒ ãƒ­ã‚°ã‚¤ãƒ³ä¿ƒé€² | âœ… |
| ã‚³ãƒ¡ãƒ³ãƒˆã«ã„ã„ã­ | âŒ ãƒ­ã‚°ã‚¤ãƒ³ä¿ƒé€² | âœ… |
| ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ | âŒ ãƒ­ã‚°ã‚¤ãƒ³ä¿ƒé€² | âœ… |
| æŠ•ç¨¿ä½œæˆ | âŒ ãƒ­ã‚°ã‚¤ãƒ³ä¿ƒé€² | âœ… |
| è‡ªåˆ†ã®æŠ•ç¨¿ç·¨é›†/å‰Šé™¤ | - | âœ… |
| è¨ºæ–­çµæœä¿å­˜ | localStorage | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |

---

## UI ãƒ‡ã‚¶ã‚¤ãƒ³è¦ç‚¹

### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ä¸€è¦§ãƒšãƒ¼ã‚¸
- ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆPC 4åˆ— â†’ ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ 3åˆ— â†’ ã‚¹ãƒãƒ› 2åˆ—ï¼‰
- ã‚«ãƒ¼ãƒ‰ï¼šç”»åƒ + ã‚¿ã‚¤ãƒˆãƒ« + ä½œè€…ã‚¢ãƒã‚¿ãƒ¼/ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ  + ã‚¿ã‚¤ãƒ—ãƒ©ãƒ™ãƒ« + ã„ã„ã­æ•°
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼šäººæ°— / æ–°ç€ / ã‚¿ã‚¤ãƒ—åˆ¥

### æŠ•ç¨¿è©³ç´°
- PCï¼šãƒ¢ãƒ¼ãƒ€ãƒ«ã€å·¦ç”»åƒãƒ»å³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
- ã‚¹ãƒãƒ›ï¼šãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã€ä¸Šç”»åƒãƒ»ä¸‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
- ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã¯è¿”ä¿¡å¯¾å¿œ

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ©ãƒ™ãƒ«
- ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ æ¨ªã«çŒ«ã‚¿ã‚¤ãƒ—ãƒ©ãƒ™ãƒ«è¡¨ç¤ºï¼ˆä¾‹ï¼šğŸ±æ¢æ¤œå®¶çŒ«ï¼‰
- æŠ•ç¨¿ã€ã‚³ãƒ¡ãƒ³ãƒˆæ™‚ã«è¡¨ç¤º

### åŒã‚¿ã‚¤ãƒ—ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤º
- çµæœãƒšãƒ¼ã‚¸ä¸‹éƒ¨ã«åŒã‚¿ã‚¤ãƒ—ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ãƒã‚¿ãƒ¼ã‚’ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤º
- ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€ãƒ›ãƒãƒ¼ã§åœæ­¢
- ã‚¯ãƒªãƒƒã‚¯ã§ãã®æŠ•ç¨¿ã¸é·ç§»

---

## é–‹ç™ºé †åº

### Phase 1ï¼šSupabase åŸºæœ¬è¨­å®š
1. Supabase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. SQL ã§ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
3. Row Level Security (RLS) è¨­å®š
4. js/supabase.js åˆæœŸåŒ–ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

### Phase 2ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
1. login.html ã§å®Ÿéš›ã®ãƒ­ã‚°ã‚¤ãƒ³/ç™»éŒ²å®Ÿè£…
2. js/auth.js ä½œæˆ
3. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³çµ±ä¸€ï¼ˆãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹è¡¨ç¤ºï¼‰
4. è¨ºæ–­çµæœã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ãƒ†ã‚¹ãƒˆ

### Phase 3ï¼šã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ©Ÿèƒ½
1. community.html ã¨ css/community.css ä½œæˆ
2. æŠ•ç¨¿ä¸€è¦§ï¼ˆã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ•ã‚©ãƒ¼ãƒ«ï¼‰å®Ÿè£…
3. æŠ•ç¨¿è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«å®Ÿè£…
4. ã„ã„ã­æ©Ÿèƒ½å®Ÿè£…
5. ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½å®Ÿè£…ï¼ˆè¿”ä¿¡å¯¾å¿œï¼‰

### Phase 4ï¼šæŠ•ç¨¿æ©Ÿèƒ½
1. result.html ã«ã€Œã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«æŠ•ç¨¿ã€ãƒœã‚¿ãƒ³è¿½åŠ 
2. æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ«å®Ÿè£…
3. ã‚·ã‚§ã‚¢ç”»åƒã‚’ Supabase Storage ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

### Phase 5ï¼šãƒã‚¤ãƒšãƒ¼ã‚¸
1. mypage.html ã¨ css/mypage.css ä½œæˆ
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºï¼ˆç·¨é›†å¯èƒ½ï¼‰
3. è¨ºæ–­å±¥æ­´è¡¨ç¤º
4. æŠ•ç¨¿ä¸€è¦§è¡¨ç¤ºï¼ˆç·¨é›†/å‰Šé™¤å¯èƒ½ï¼‰

### Phase 6ï¼šæœ€é©åŒ–ã¨ä»•ä¸Šã’
1. index.html ã«ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¿½åŠ 
2. result.html ã«åŒã‚¿ã‚¤ãƒ—ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤ºè¿½åŠ 
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
4. ãƒ†ã‚¹ãƒˆã¨ä¿®æ­£

---

## Supabase è¨­å®šæƒ…å ±ï¼ˆè¨˜å…¥æ¬„ï¼‰

```javascript
const SUPABASE_URL = ''; // ä¾‹: https://xxxxx.supabase.co
const SUPABASE_ANON_KEY = ''; // ä¾‹: eyJhbGciOiJS...
```

---

## Supabase SQLï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆç”¨ï¼‰

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE profiles (
  id UUID REFERENCES auth.users(id) PRIMARY KEY,
  username TEXT UNIQUE NOT NULL,
  avatar_url TEXT,
  primary_cat_type TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- è¨ºæ–­çµæœãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE results (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES profiles(id) ON DELETE SET NULL,
  session_id TEXT,
  cat_type TEXT NOT NULL,
  cat_name TEXT,
  cat_avatar TEXT,
  scores JSONB NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- æŠ•ç¨¿ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE posts (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
  result_id UUID REFERENCES results(id) ON DELETE CASCADE NOT NULL,
  caption TEXT,
  share_image_url TEXT,
  likes_count INTEGER DEFAULT 0,
  comments_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ã„ã„ã­ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE likes (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  post_id UUID REFERENCES posts(id) ON DELETE CASCADE NOT NULL,
  user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(post_id, user_id)
);

-- ã‚³ãƒ¡ãƒ³ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE comments (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  post_id UUID REFERENCES posts(id) ON DELETE CASCADE NOT NULL,
  user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
  parent_id UUID REFERENCES comments(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  likes_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ã‚³ãƒ¡ãƒ³ãƒˆã„ã„ã­ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE comment_likes (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  comment_id UUID REFERENCES comments(id) ON DELETE CASCADE NOT NULL,
  user_id UUID REFERENCES profiles(id) ON DELETE CASCADE NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(comment_id, user_id)
);

-- Row Level Security æœ‰åŠ¹åŒ–
ALTER TABLE profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE results ENABLE ROW LEVEL SECURITY;
ALTER TABLE posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE likes ENABLE ROW LEVEL SECURITY;
ALTER TABLE comments ENABLE ROW LEVEL SECURITY;
ALTER TABLE comment_likes ENABLE ROW LEVEL SECURITY;

-- RLS ãƒãƒªã‚·ãƒ¼ï¼šå…¨å“¡èª­ã¿å–ã‚Šå¯èƒ½
CREATE POLICY "Public read" ON profiles FOR SELECT USING (true);
CREATE POLICY "Public read" ON results FOR SELECT USING (true);
CREATE POLICY "Public read" ON posts FOR SELECT USING (true);
CREATE POLICY "Public read" ON likes FOR SELECT USING (true);
CREATE POLICY "Public read" ON comments FOR SELECT USING (true);
CREATE POLICY "Public read" ON comment_likes FOR SELECT USING (true);

-- RLS ãƒãƒªã‚·ãƒ¼ï¼šè‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿æ“ä½œå¯èƒ½
CREATE POLICY "Users can insert own" ON profiles FOR INSERT WITH CHECK (auth.uid() = id);
CREATE POLICY "Users can update own" ON profiles FOR UPDATE USING (auth.uid() = id);

CREATE POLICY "Users can insert own" ON results FOR INSERT WITH CHECK (auth.uid() = user_id OR user_id IS NULL);
CREATE POLICY "Users can update own" ON results FOR UPDATE USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own" ON posts FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Users can update own" ON posts FOR UPDATE USING (auth.uid() = user_id);
CREATE POLICY "Users can delete own" ON posts FOR DELETE USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own" ON likes FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Users can delete own" ON likes FOR DELETE USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own" ON comments FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Users can delete own" ON comments FOR DELETE USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own" ON comment_likes FOR INSERT WITH CHECK (auth.uid() = user_id);
CREATE POLICY "Users can delete own" ON comment_likes FOR DELETE USING (auth.uid() = user_id);

-- ã„ã„ã­æ•°ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã®è‡ªå‹•æ›´æ–°ç”¨é–¢æ•°
CREATE OR REPLACE FUNCTION update_post_likes_count()
RETURNS TRIGGER AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    UPDATE posts SET likes_count = likes_count + 1 WHERE id = NEW.post_id;
  ELSIF TG_OP = 'DELETE' THEN
    UPDATE posts SET likes_count = likes_count - 1 WHERE id = OLD.post_id;
  END IF;
  RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_post_likes_count
AFTER INSERT OR DELETE ON likes
FOR EACH ROW EXECUTE FUNCTION update_post_likes_count();

CREATE OR REPLACE FUNCTION update_post_comments_count()
RETURNS TRIGGER AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    UPDATE posts SET comments_count = comments_count + 1 WHERE id = NEW.post_id;
  ELSIF TG_OP = 'DELETE' THEN
    UPDATE posts SET comments_count = comments_count - 1 WHERE id = OLD.post_id;
  END IF;
  RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_post_comments_count
AFTER INSERT OR DELETE ON comments
FOR EACH ROW EXECUTE FUNCTION update_post_comments_count();

-- ã‚³ãƒ¡ãƒ³ãƒˆã„ã„ã­æ•°ã®è‡ªå‹•æ›´æ–°ç”¨é–¢æ•°
CREATE OR REPLACE FUNCTION update_comment_likes_count()
RETURNS TRIGGER AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    UPDATE comments SET likes_count = likes_count + 1 WHERE id = NEW.comment_id;
  ELSIF TG_OP = 'DELETE' THEN
    UPDATE comments SET likes_count = likes_count - 1 WHERE id = OLD.comment_id;
  END IF;
  RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_update_comment_likes_count
AFTER INSERT OR DELETE ON comment_likes
FOR EACH ROW EXECUTE FUNCTION update_comment_likes_count();
```

---

## å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- Supabase ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼šhttps://supabase.com/docs
- Supabase JS SDKï¼šhttps://supabase.com/docs/reference/javascript
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆURLï¼šhttps://mgalo1231.github.io/catsonality/

---

*æœ€çµ‚æ›´æ–°ï¼š2026å¹´1æœˆ30æ—¥*
